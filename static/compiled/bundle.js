var __decorate=this&&this.__decorate||function(t,e,s,i){var n,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,s,r):n(e,s))||r);return a>3&&r&&Object.defineProperty(e,s,r),r},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};System.register("types",[],function(t,e){"use strict";e&&e.id;return{setters:[],execute:function(){}}}),System.register("services/feed",["@angular/core","@angular/http","rxjs","rxjs/operators"],function(t,e){"use strict";var s,i,n,a,r;e&&e.id;return{setters:[function(t){s=t},function(t){i=t},function(t){n=t},function(t){a=t}],execute:function(){r=class{constructor(t){this.t=t,this.e=new n.ReplaySubject(1),this.s=!1}getFeeds(){return this.s||this.i(),this.e}reloadFeeds(){return this.s?this.i():this.e}n(){this.e.next(this.a)}i(){this.s=!0;const t=this.t.get("/api/feeds/list").pipe(a.map(t=>t.json()),a.share());return t.subscribe(t=>{t.error?console.error(t.error):(this.a=t,this.n())},t=>console.error(t)),t}},r=__decorate([s.Injectable(),__metadata("design:paramtypes",[i.Http])],r),t("FeedService",r)}}}),System.register("services/item",["@angular/core","@angular/http","rxjs","rxjs/operators"],function(t,e){"use strict";var s,i,n,a,r;e&&e.id;return{setters:[function(t){s=t},function(t){i=t},function(t){n=t},function(t){a=t}],execute:function(){r=class{constructor(t){this.t=t,this.r=[],this.o=new n.ReplaySubject(1),this.c=!1}getAllUnreadItems(){return this.c||this.l(),this.o}markItemAsRead(t){var e=this.t.post("/api/items/"+t+"/read","").pipe(a.map(t=>t.json()),a.share());return e.subscribe(t=>{t.error?console.error(t.error):this.u(t)},t=>console.error(t)),e}markItemAsUnread(t){const e=this.t.post("/api/items/"+t+"/unread","").pipe(a.map(t=>t.json()),a.share());return e.subscribe(t=>{t.error?console.error(t.error):this.u(t)},t=>console.error(t)),e}reloadItems(){return this.c?this.l():this.o}n(){this.o.next(this.r)}u(t){var e=this.r.findIndex(e=>e.id===t.id);if(-1!=e)this.r[e]=t;else{if(t.read)return;for(e=0;e<this.r.length&&this.r[e].timestamp>t.timestamp;)e++;this.r.splice(e,0,t)}this.n()}l(){this.c=!0;const t=this.t.get("/api/items/list").pipe(a.map(t=>t.json()),a.share());return t.subscribe(t=>{t.error?console.error(t.error):(this.r=t,this.n())},t=>console.error(t)),t}},r=__decorate([s.Injectable(),__metadata("design:paramtypes",[i.Http])],r),t("ItemService",r)}}}),System.register("components/abstract-item-list",["rxjs","@angular/core"],function(t,e){"use strict";var s,i;e&&e.id;return{setters:[function(t){s=t},function(t){i=t}],execute:function(){t("AbstractItemList",class{constructor(t,e,s){this.m=t,this.h=e,this.d=s,this.a={},this.r=[],this.f=!1}markItemAsRead(t){return this.h.markItemAsRead(t)}markItemAsUnread(t){return this.h.markItemAsUnread(t)}getFeed(t){return this.a[t]}getItems(){return this.r}isRefreshing(){return this.f}getError(){return this.p}getItemUrl(t){return t.url.startsWith("magnet:")?this.d.bypassSecurityTrustUrl(t.url):this.d.sanitize(i.SecurityContext.URL,t.url)}getItemMobileUrl(t){if(t.url.startsWith("https://manga.madokami.al/")){let e=t.url.split("madokami.al")[1];return"https://manga.madokami.al/reader/"+(e=(e=encodeURIComponent(e)).replace(/%2F/g,"%252F"))}}handleItemClick(t,e){1!=t.button||e.read||this.markItemAsRead(e.id)}refresh(){this.f=!0,s.zip(this.m.reloadFeeds(),this.h.reloadItems()).subscribe(()=>{this.p=null,this.f=!1},t=>{this.p=t,this.f=!1})}})}}}),System.register("components/item-list",["services/feed","services/item","components/abstract-item-list","@angular/core","@angular/platform-browser"],function(t,e){"use strict";var s,i,n,a,r,o;e&&e.id;return{setters:[function(t){s=t},function(t){i=t},function(t){n=t},function(t){a=t},function(t){r=t}],execute:function(){o=class extends n.AbstractItemList{constructor(t,e,s){super(t,e,s)}ngOnInit(){this.m.getFeeds().subscribe(t=>{for(var e of(this.a={},t))this.a[e.id]=e}),this.h.getAllUnreadItems().subscribe(t=>{this.r=t})}handleKeydown(t){"r"!=t.key||t.ctrlKey||t.altKey||t.shiftKey||t.metaKey||this.refresh()}getItems(){return this.r.filter(t=>this.a[t.feedId]&&!this.a[t.feedId].disabled)}},__decorate([a.HostListener("window:keydown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[KeyboardEvent]),__metadata("design:returntype",void 0)],o.prototype,"handleKeydown",null),o=__decorate([a.Component({selector:"item-list",template:'<button (click)="refresh()" [disabled]="isRefreshing()">Refresh</button> <span *ngIf="getError()">{{getError()}}</span><div *ngFor="let item of getItems(); trackBy id" class="item" [class.read]="item.read"><div class="feed-title">{{getFeed(item.feedId)?.userTitle || getFeed(item.feedId)?.title}}</div><a [href]="getItemUrl(item)" (mouseup)="handleItemClick($event, item)" class="item-title" [class.non-mobile-link]="getItemMobileUrl(item)" rel="noopener" target="_blank">{{item.title||item.url}}</a> <a [href]="getItemMobileUrl(item)" *ngIf="getItemMobileUrl(item)" (mouseup)="handleItemClick($event, item)" class="item-title mobile-link" rel="noopener" target="_blank">{{item.title||item.url}}</a> <button *ngIf="!item.read" (click)="markItemAsRead(item.id)">Read</button> <button *ngIf="item.read" (click)="markItemAsUnread(item.id)">Unread</button></div>'}),__metadata("design:paramtypes",[s.FeedService,i.ItemService,r.DomSanitizer])],o),t("ItemList",o)}}}),System.register("components/main",["@angular/core"],function(t,e){"use strict";var s,i;e&&e.id;return{setters:[function(t){s=t}],execute:function(){i=class{},i=__decorate([s.Component({selector:"main",template:'<nav class="navbar navbar-inverse sidebar" role="navigation"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-sidebar-navbar-collapse-1"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div class="navbar-brand" href="#">DesuRSS</div></div><div class="collapse navbar-collapse" id="bs-sidebar-navbar-collapse-1"><ul class="nav navbar-nav"><li class="active"><a href="/">Home<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-home"></span></a></li><li><a href="#">Profile<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-user"></span></a></li></ul></div></div></nav><div class="navbar-main"><item-list></item-list></div>'})],i),t("Main",i)}}}),System.register("module",["components/main","services/item","services/feed","components/item-list","@angular/core","@angular/platform-browser","@angular/platform-browser-dynamic","@angular/http"],function(t,e){"use strict";var s,i,n,a,r,o,c,l,u,m;e&&e.id;return{setters:[function(t){s=t},function(t){i=t},function(t){n=t},function(t){a=t},function(t){r=t},function(t){o=t},function(t){c=t},function(t){l=t}],execute:function(){u=class{},u=__decorate([r.NgModule({imports:[o.BrowserModule,l.HttpModule],declarations:[s.Main,a.ItemList],providers:[n.FeedService,i.ItemService],bootstrap:[s.Main]})],u),m=c.platformBrowserDynamic(),window.location.pathname.startsWith("/dev/")||r.enableProdMode(),m.bootstrapModule(u)}}});
//# sourceMappingURL=maps/bundle.js.map
